<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>test #2</title>
    <style>
        li{
            list-style:none;
        }
        .bl{
            color:blue;
        }
        #menu2{
            background-color: burlywood;
            width: 400px;
        }
        #add{
            background-color: aliceblue;
            font-size: 18px;
            width: 450px;
        }
    </style>
</head>
<body>
    <div id="menu">
        <ul>
            <div id="add">
                <li><a  class="bl" href="/add-regions ">добавляем регионы</a></li>
                <li><a href="/parse-cities">добавляем города-районные центры</a></li>
                <li><a href="/ukr-parse ">добавляем районы </a></li>
                <li><a href="/parse-streets/donetsk"><strong>добавление улиц и районов [Донецк]</strong></a></li>
                <li><a href="/parse-streets/kyiv"><strong>добавление улиц и районов [Киев]</strong></a></li>
                <li><a href="/parse-streets/odessa"><strong>добавление улиц и районов [Одесса]</strong></a></li>
                <li><a href="/parse-streets/lviv"><strong>добавление улиц и районов [Львов]</strong></a></li>
                <li><a href="/parse-streets/mariupol"><strong>добавление улиц и районов [Мариуполь]</strong></a></li>
                <li><a href="/parse-streets/zaporizhzhia"><strong>добавление улиц и районов [Запорожье]</strong></a></li>
                <li><a href="/parse-streets/kropivnitsky"><strong>добавление улиц и районов [Кропивницкий]</strong></a></li>
                <li><a href="/parse-streets/mycolaiv"><strong>добавление улиц и районов [Николаев]</strong></a></li>
                <li><a href="/parse-streets/kharkiv"><strong>добавление улиц и районов [Харьков]</strong></a></li>
                <li><a href="/parse-streets/all-other"><strong>добавление улиц и районов [Все остальные-без улиц]</strong></a></li>
            </div>
            <hr>
            <li><a href="/parse ">парсинг судов</a></li>
            <li><a href="/modeltest/find ">ищем район</a></li>
            <li><a href="/openmap">open map  - new</a></li>
            <li><a href="/openmap/json">open map (json)</a></li>
            <li><a href="/openmap/test">open map (структурный ввод)</a></li>
            <li><a href="/openmap/query">open map (НЕ структурный ввод)</a></li>
            <li><a href="/modeltest ">тестим модель</a></li>
        </ul>
    </div>

    <div id="menu2">
        <ul>
            <li><a href="/api/find-subarea">поиск subarea</a></li>
            <li><a href="/api/find-court-by/subarea">поиск суда по району города</a></li>
            <li><a href="/api/area">поиск района по селу и области</a></li>
        </ul>
    </div>

    <div>
        <a href="/company-parse" style="background-color: darkblue; color: white; font-size: 20px">парсер компаний</a>
    </div>
    <hr>
    <div id="enter">
        <label for="region">область: </label>
        <input type="text" id="region">
        <br>
        <label for="city">село/город: </label>
        <input type="text" id="city">
        <br>
        <label for="street">улица: </label>
        <input type="text" id="street">
        <br>
        <button id="btn">найти район</button>
    </div>
    <div id="result"></div>
    <hr>
    <button id="getOsm">получение данных с помощью сервиса OSM</button>
    <script>
        document.addEventListener("DOMContentLoaded", ready);
        function ready() {
            var btn = document.getElementById('btn');
            var city = document.getElementById('city');
            var region = document.getElementById('region');
            var street = document.getElementById('street');
            var result = document.getElementById('result');
            var getOsm = document.getElementById('getOsm');
            result.style.color = 'blue';
            btn.addEventListener('click', function () {
                if (city.value !== '' &&  region.value !== '' && street.value !== ''){
                    var x = new XMLHttpRequest();
                    var url = "/api/area?city="+String(city.value)+"&region="+String(region.value)+"&street="+String(street.value);
                    x.open("GET", url, true);
                    x.onload = function (){
                        if (x.status === 200 && x.readyState === 4) {
                            console.log(JSON.parse(x.responseText));
                            var areas = JSON.parse(x.responseText);
                            console.log(areas.length);
                            if (areas.length > 1) {
                                var select = document.createElement("select");
                                var option = document.createElement("option");
                                option.setAttribute("value", '');
                                select.appendChild(option);
                                for (var i=0; i<areas.length; i++){
                                    option = document.createElement("option");
                                    option.setAttribute("value", areas[i]);
                                    option.innerHTML = areas[i];
                                    select.appendChild(option);
                                }
                                result.innerHTML='Несколько районов  ';
                                result.appendChild(select);
                                select.addEventListener("change", function (event) {
                                    refinementData(event.target.value);
                                });
                            }
                            if (areas.area && areas.court) {
                                result.innerHTML = 'район:  ' + areas.area + "<br> суд: " + areas.court.name.last.ua;
                                console.log(areas);
                            }
                        }
                        if (x.status === 503) {
                            result.innerHTML = 'район и суд получить не удалось';
                        }
                    };
                    x.send(null);
                } else {
                    result.innerHTML = 'enter the address, please';
                }
            });

            getOsm.addEventListener('click',function () {
                if (city.value !== '' &&  region.value !== '' && street.value !== ''){
                    var url = "/openmap?city="+String(city.value)+"&region="+String(region.value)+"&street="+String(street.value);
                    var x = new XMLHttpRequest();
                    x.open("GET", url, true);
                    x.onload = function (){
                        if (x.status === 200 && x.readyState === 4){
                            console.log(x.responseText);
                            result.innerHTML = x.responseText;
                        }
                        if (x.status === 503) {
                            result.innerHTML = 'получить район с помощью сервиса OSM не удалось';
                        }
                    };
                    x.send(null);
                }
            });

            function refinementData(area) {
                var url = "/api/area?refinement="+String(area)+"&region="+String(region.value)+"&city="+String(city.value);
                console.log(url);
                var x = new XMLHttpRequest();
                x.open("GET", url, true);
                x.onload = function () {
                    if (x.status === 200 && x.readyState === 4) {
                        var area = JSON.parse(x.responseText);
                        result.innerHTML = 'район:  '+area.area+"<br> суд: "+area.court.name.last.ua;
                    }
                    if (x.status === 503) {
                        result.innerHTML = 'район и суд получить не удалось';
                    }
                };
                x.send(null);
            }
        }

    </script>

    <!--<script>-->
        <!--var btn = document.getElementById('btn');-->
        <!--var btn2 = document.getElementById('btn2');-->
        <!--var area = document.getElementById('area');-->
        <!--var region = document.getElementById('region');-->
        <!--var result = document.getElementById('result');-->
        <!--var address = document.getElementById('address');-->
        <!--result.style.color = 'blue';-->
        <!--btn.addEventListener('click', function () {-->
            <!--if (area.value !== '' &&  region.value !== ''){-->
                <!--var x = new XMLHttpRequest();-->
                <!--var url = "/findcourt?area="+String(area.value)+"&region="+String(region.value);-->
                <!--x.open("GET", url, true);-->
                <!--x.onload = function (){-->
                    <!--result.innerHTML = x.responseText;-->
                <!--};-->
                <!--x.send(null);-->
                <!--console.log(inpt.value);-->
            <!--} else {-->
                <!--result.innerHTML = 'enter the address, please';-->
            <!--}-->
        <!--});-->
        <!--btn2.addEventListener('click', function () {-->
           <!--if (address.value !=='') {-->
               <!--var x = new XMLHttpRequest();-->
               <!--var url = "/openmap/query?address="+String(address.value);-->
               <!--x.open("GET", url, true);-->
               <!--x.onload = function (){-->
                   <!--result.innerHTML = x.responseText;-->
                   <!--console.log(x.responseText);-->
               <!--};-->
               <!--x.send(null);-->
           <!--} else {-->
               <!--result.innerHTML = 'enter the address, please';-->
           <!--}-->
        <!--});-->
    <!--</script>-->

    <!--<hr>-->
    <!--Казацкое, Белгород-Днестровский район, Одесская область, 67733-->
    <!--<hr>-->
    <!--Одесса ул. Жуковского 23, 65045-->
    <!--<hr>-->

</body>

</html>